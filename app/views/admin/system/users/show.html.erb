<%=  render partial: 'admin/shared/user_summary', locals: { user: @user } %>


<ul class="nav nav-tabs" role="tablist">
  <li role="presentation" class="<%= "active" if ["logins", "", nil].include? params[:q] %>"><a href="<%= admin_system_user_path(@user, q: "logins")%>" role="tab">Logins</a></li>
  <li role="presentation" class="<%= "active" if params[:q] == "orders" %>"><a href="<%= admin_system_user_path(@user, q: "orders")%>" role="tab">Orders</a></li>
  <li role="presentation" class="<%= "active" if params[:q] == "tickets" %>"><a href="<%= admin_system_user_path(@user, q: "tickets")%>" role="tab">Tickets</a></li>
  <li role="presentation" class="<%= "active" if params[:q] == "pictures" %>"><a href="<%= admin_system_user_path(@user, q: "pictures")%>" role="tab">Photos</a></li>
  <li role="presentation" class="<%= "active" if params[:q] == "locations" %>"><a href="<%= admin_system_user_path(@user, q: "locations")%>" role="tab">Locations</a></li>
  <li role="presentation" class="<%= "active" if params[:q] == "cc" %>"><a href="<%= admin_system_user_path(@user, q: "cc")%>" role="tab">CC</a></li>
  <li role="presentation" class="<%= "active" if params[:q] == "subs" %>"><a href="<%= admin_system_user_path(@user, q: "subs")%>" role="tab">Subscriptions</a></li>
  <li role="presentation" class="<%= "active" if params[:q] == "dids" %>"><a href="<%= admin_system_user_path(@user, q: "dids")%>" role="tab">DID's</a></li>
  <li role="presentation" class="<%= "active" if params[:q] == "fwd" %>"><a href="<%= admin_system_user_path(@user, q: "fwd")%>" role="tab">Forwarding Nums</a></li>
  <li role="presentation" class="<%= "active" if params[:q] == "mnu" %>"><a href="<%= admin_system_user_path(@user, q: "mnu")%>" role="tab">Menus</a></li>
  <li role="presentation" class="<%= "active" if params[:q] == "prt" %>"><a href="<%= admin_system_user_path(@user, q: "prt")%>" role="tab">Audio</a></li>
  <li role="presentation" class="<%= "active" if params[:q] == "vm" %>"><a href="<%= admin_system_user_path(@user, q: "vm")%>" role="tab">Voicemail</a></li>
  <li role="presentation" class="<%= "active" if params[:q] == "cdr" %>"><a href="<%= admin_system_user_path(@user, q: "cdr")%>" role="tab">CDR</a></li>
</ul>

<% if params[:q] == "orders" 
  orders = Order.where(user_id: params[:id]).where.not(status: "in cart").order(submitted: :desc).paginate(page: params[:page], per_page: 10) %>
  
  <%= will_paginate orders %>
  <table class="table table-striped table-condensed">
  	<tr>
  		<th>Order #</th>
      <th>Sales Channel</th>
  		<th>Date</th>
  		<th>Customer</th>
  		<th>Location</th>
  		<th>Amount</th>
  		<th>Status</th>
  	</tr>
  	<% orders.each do |order| %>
  	<tr>
  		<td><%= link_to order.id, admin_store_order_path(order) %></td>
        <td><%= order.sales_channel %></td>
  		<td><%= systime order.submitted if order.submitted%></td>
  		<td><%= order.shipping_name || order.billing_name %></td>
  		<td><%= order.shipping_city %>, <%= order.shipping_state %></td>
  		<td><%= number_to_currency(order.total) %></td>
  		<td><%= order_status(order) %></td>
  	</tr>
  	<% end %>
  </table>

<% elsif params[:q] == "tickets" %>

  <% cases = Case.where(user_id: params[:id]).order(created_at: :desc) %>

  <table class="table table-striped table-condensed">
  	<tr>
      <th>ID</th>
      <th>Received</th>
      <th>From</th>
      <th>Subject</th>
      <th>Status</th>
      <th>Priority</th>
      <th>Assigned to</th>
  	</tr>
  	<% cases.each do |c| %>
  	<tr class="<%= "light" if c.status == "closed" %>">
  		<td><%= link_to c.id, admin_ticketing_case_path(c) %></td>
      <td nowrap><%= systime c.received_at %></td>
      <td>
        <% if c.user_id %>
          <%= link_to c.user.name, admin_system_user_path(c.user_id) %>
        <% else %>
          <%= c.name %>
        <% end %>
      </td>
  		<td>
        <%= truncate c.subject, length: 40 %>
        <% unless c.attachments.blank? %>
          <i class="fa fa-paperclip"></i>
        <% end %>
      </td>
      <td><%= case_status_indicator c %></td>
      <td><%= case_priority_indicator c %></td>
  		<td><% unless c.assigned_to.nil? %>
  			<%= link_to c.assignee.name, admin_system_user_path(c.assigned_to) %>
  			<% else %>
  			- none -
  			<% end%>
  		</td>
  	</tr>
  	<% end %>
  </table>
  
<% elsif params[:q] == "pictures" %>

  <% pics = Picture.where(user_id: params[:id]).order(created_at: :desc) %>

  <% pics.each do |pic| %>
    <%= link_to edit_admin_cms_picture_path(pic) do %>
      <img src="<%= cdn_image_url pic.file_path, 100, 100, 0 %>" class="img-thumbnail" alt="<%= pic.caption %>" style="margin: 4px;">
    <% end %>
  <% end %>

<% else %>

  <% logins = Login.where(user_id: @user.id).paginate(page: params[:page], per_page: 10).order(timestamp: :desc) %>
  
  <%= will_paginate logins %>
  <table class="table table-striped table-condensed">
  	<tr>
  		<th>Timestamp</th>
      <th>Source</th>
  		<th>IP Address</th>
  		<th>Platform</th>
  		<th>Browser</th>
  	</tr>
  	<% logins.each do | login | 
  		user_agent = UserAgent.parse(login.user_agent)%>
  	<tr>
  		<td><%= systime login.timestamp %></td>
      <td><%= login.source %></td>
  		<td><%= login.ip_address %></td>
  		<td><%= user_agent.platform %></td>
  		<td><%= user_agent.browser %> <%= user_agent.version %></td>
  	</tr>
  	<% end %>
  </table>

<% end %>





<% content_for :title do %>
	Users: <%= @user.name %>
<% end %>


<% content_for :head do %>
  <style>
  ul.pagination { margin-top: 10px; }
  </style>
<% end %>

<% content_for :menu do
    render "admin/shared/system_menu"
end %>


<% content_for :breadcrumbs do %>
	<li><a href="#">System</a></li>
	<li><%= link_to "Users", admin_system_users_path %></li>
	<li class="active"><%= @user.name %></li>
<% end %>